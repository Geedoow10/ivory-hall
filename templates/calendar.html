{% extends "base.html" %}
{% block content %}

<h2 style="margin:20px 0 16px;">Weekly Calendar</h2>

<div class="card" style="margin-bottom:16px;">
  <div class="card-inner">
    <form method="get" action="/calendar" style="display:flex; gap:10px; align-items:flex-end; flex-wrap:wrap;">
      <div style="flex:1; min-width:200px;">
        <label>Hall</label>
        <select name="hall">
          <option value="">All halls</option>
          {% for h in halls %}
            <option value="{{ h }}" {% if hall == h %}selected{% endif %}>{{ h }}</option>
          {% endfor %}
        </select>
      </div>
      <button class="btn btn-gold" type="submit">Filter</button>
    </form>

    <div style="margin-top:14px; display:flex; gap:16px; flex-wrap:wrap;">
      <a class="btn" href="/calendar?start={{ prev_week }}{% if hall %}&hall={{ hall }}{% endif %}">⬅ Previous week</a>
      <a class="btn" href="/calendar?start={{ next_week }}{% if hall %}&hall={{ hall }}{% endif %}">Next week ➡</a>
    </div>

    <div style="margin-top:10px; color:var(--muted); font-size:13px;">
      <b>Week starting:</b> {{ week_start }}
    </div>
  </div>
</div>

<style>
.calendar-grid{
  display:grid;
  grid-template-columns: repeat(7, 1fr);
  gap:10px;
}
.day-col{
  background: linear-gradient(180deg, rgba(17,28,51,.85), rgba(15,23,42,.70));
  border:1px solid rgba(255,255,255,.08);
  border-radius:14px;
  padding:12px;
  min-height:200px;
}
.day-title{
  font-weight:800;
  font-size:13px;
  margin-bottom:10px;
  color:var(--gold);
  text-transform:uppercase;
  letter-spacing:.06em;
}
.booking-item{
  border:1px solid rgba(255,255,255,.10);
  border-radius:10px;
  padding:10px;
  margin:8px 0;
  background:rgba(255,255,255,.03);
}
.small{ font-size:12px; color:var(--muted); }
@media(max-width:900px){
  .calendar-grid{ grid-template-columns: repeat(3, 1fr); }
}
@media(max-width:500px){
  .calendar-grid{ grid-template-columns: 1fr; }
}
</style>

<div class="calendar-grid">
  {% for d in days %}
    <div class="day-col">
      <div class="day-title">
        {{ d.strftime("%a") }}<br>
        <span style="font-weight:400; color:var(--text);">{{ d.strftime("%d %b") }}</span>
      </div>

      {% set key = d.isoformat() %}
      {% if bookings_by_day[key] and bookings_by_day[key]|length > 0 %}
        {% for b in bookings_by_day[key] %}
          <div class="booking-item">
            <div style="font-weight:700; font-size:13px;">{{ b.title }}</div>
            <div class="small">{{ b.hall_name }}</div>
            <div class="small">{{ b.start_time.strftime("%H:%M") }} – {{ b.end_time.strftime("%H:%M") }}</div>
            <div style="margin-top:6px;">
              {% if b.status == "approved" %}
                <span class="badge b-approved">APPROVED</span>
              {% elif b.status == "rejected" %}
                <span class="badge b-rejected">REJECTED</span>
              {% elif b.status == "cancelled" %}
                <span class="badge b-cancelled">CANCELLED</span>
              {% else %}
                <span class="badge b-pending">PENDING</span>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="small">No bookings</div>
      {% endif %}
    </div>
  {% endfor %}
</div>

{% endblock %}
