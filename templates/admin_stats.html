{% extends "base.html" %}
{% block content %}

<style>
.stats-grid{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap:14px;
  margin-bottom:24px;
}
.stat-card{
  background: linear-gradient(180deg, rgba(17,28,51,.85), rgba(15,23,42,.70));
  border:1px solid rgba(255,255,255,.08);
  border-radius:16px;
  padding:20px;
  text-align:center;
}
.stat-number{ font-size:42px; font-weight:900; line-height:1; }
.stat-label{ color:var(--muted); font-size:13px; margin-top:6px; text-transform:uppercase; letter-spacing:.06em; }
.bar-wrap{ margin:6px 0 16px; }
.bar-label{ font-size:13px; margin-bottom:4px; display:flex; justify-content:space-between; }
.bar-bg{ background:rgba(255,255,255,.08); border-radius:999px; height:10px; overflow:hidden; }
.bar-fill{ height:10px; border-radius:999px; transition:.4s; }
.section-title{ font-size:18px; font-weight:800; letter-spacing:.08em; text-transform:uppercase; margin:24px 0 12px; color:var(--muted); }
.table{ width:100%; border-collapse:collapse; }
.table th, .table td{ padding:11px 12px; border-bottom:1px solid rgba(255,255,255,.08); text-align:left; font-size:14px; }
.table th{ color:var(--muted); font-size:12px; text-transform:uppercase; letter-spacing:.05em; }
</style>

<h2 style="margin:20px 0 16px;">üìä Booking Statistics</h2>

<!-- STAT CARDS -->
<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-number" style="color:var(--gold);">{{ total }}</div>
    <div class="stat-label">Total Bookings</div>
  </div>
  <div class="stat-card">
    <div class="stat-number" style="color:#fbbf24;">{{ pending_count }}</div>
    <div class="stat-label">Pending</div>
  </div>
  <div class="stat-card">
    <div class="stat-number" style="color:#86efac;">{{ approved_count }}</div>
    <div class="stat-label">Approved</div>
  </div>
  <div class="stat-card">
    <div class="stat-number" style="color:#fca5a5;">{{ rejected_count }}</div>
    <div class="stat-label">Rejected</div>
  </div>
  <div class="stat-card">
    <div class="stat-number" style="color:#d1d5db;">{{ cancelled_count }}</div>
    <div class="stat-label">Cancelled</div>
  </div>
</div>

<!-- STATUS BAR CHART -->
<div class="card">
  <div class="card-inner">
    <div class="section-title">Status Breakdown</div>
    {% if total > 0 %}
      {% set statuses = [
        ("Approved", approved_count, "#86efac"),
        ("Pending",  pending_count,  "#fbbf24"),
        ("Rejected", rejected_count, "#fca5a5"),
        ("Cancelled",cancelled_count,"#9ca3af"),
      ] %}
      {% for label, count, color in statuses %}
        <div class="bar-wrap">
          <div class="bar-label">
            <span>{{ label }}</span>
            <span>{{ count }} / {{ total }}</span>
          </div>
          <div class="bar-bg">
            <div class="bar-fill" style="width:{{ (count / total * 100)|round(1) }}%; background:{{ color }};"></div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p class="muted">No bookings yet.</p>
    {% endif %}
  </div>
</div>

<!-- BOOKINGS PER HALL -->
<div class="section-title">Bookings per Hall</div>
<div class="card">
  <div class="card-inner">
    {% if hall_stats %}
      {% set max_count = hall_stats | map(attribute='count') | max %}
      {% for row in hall_stats %}
        <div class="bar-wrap">
          <div class="bar-label">
            <span>{{ row.hall_name }}</span>
            <span>{{ row.count }}</span>
          </div>
          <div class="bar-bg">
            <div class="bar-fill" style="width:{{ (row.count / max_count * 100)|round(1) }}%; background:var(--gold);"></div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p class="muted">No data yet.</p>
    {% endif %}
  </div>
</div>

<!-- RECENT BOOKINGS -->
<div class="section-title">Recent Bookings</div>
<div class="card">
  <div class="card-inner">
    {% if recent %}
    <table class="table">
      <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Hall</th>
        <th>Guest</th>
        <th>Status</th>
        <th>Start</th>
      </tr>
      {% for b in recent %}
      <tr>
        <td>#{{ b.id }}</td>
        <td>{{ b.title }}</td>
        <td>{{ b.hall_name }}</td>
        <td>{{ b.guest_name or (b.owner.username if b.owner else "‚Äî") }}</td>
        <td>
          {% if b.status == "approved" %}<span class="badge b-approved">APPROVED</span>
          {% elif b.status == "rejected" %}<span class="badge b-rejected">REJECTED</span>
          {% elif b.status == "cancelled" %}<span class="badge b-cancelled">CANCELLED</span>
          {% else %}<span class="badge b-pending">PENDING</span>{% endif %}
        </td>
        <td>{{ b.start_time.strftime("%d %b %Y, %H:%M") }}</td>
      </tr>
      {% endfor %}
    </table>
    {% else %}
      <p class="muted">No bookings yet.</p>
    {% endif %}
  </div>
</div>

<div style="margin-top:16px;">
  <a class="btn btn-gold" href="{{ url_for('admin_panel') }}">‚Üê Back to Admin Panel</a>
</div>

{% endblock %}
